<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Para mi amor David ‚ù§Ô∏è</title>

    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        :root {
            --radius-xl: 2rem;
            --radius-lg: 1.5rem;
            --radius-md: 1rem;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow-x: hidden;
            line-height: 1.6;
            color: #374151;
            background-color: #fdf2f8;
        }

        .font-romance { font-family: 'Dancing Script', cursive; }

        /* fondo animado */
        .animated-bg {
            position: fixed;
            inset: 0;
            background: linear-gradient(-45deg,#f3e7ff,#eefcff,#fff0f5,#e6e6fa);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            z-index: -2;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* glass card */
        .glass-card {
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.6);
            box-shadow: 0 8px 32px rgba(31,38,135,.12);
        }

        /* tipograf√≠a fluida */
        h1 { font-size: clamp(2.8rem,7vw,5.5rem); line-height: 1.1; }
        h2 { font-size: clamp(2rem,5vw,3rem); }
        p  { font-size: clamp(1rem,2.8vw,1.25rem); }

        section {
            width: 100%;
            padding-inline: clamp(1rem,4vw,2rem);
        }

        /* hero */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            flex-direction: column;
        }

        /* --- Estilos del Contador --- */
        #contador-container {
            margin: 2rem 0;
            text-align: center;
        }
        
        .timer-box {
            display: inline-flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            justify-content: center;
            background: rgba(255, 255, 255, 0.4);
            padding: 1rem 2rem;
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(5px);
        }

        .timer-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }

        .timer-number {
            font-size: 2rem;
            font-weight: 700;
            color: #9333ea;
            line-height: 1;
        }

        .timer-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #6b7280;
            margin-top: 0.3rem;
        }

        /* carta */
        #carta {
            padding: clamp(4rem,10vw,6rem) 0;
        }

        #contenido-pdf {
            max-width: 800px;
            margin: auto;
            padding: clamp(1.5rem,4vw,3.5rem);
            border-radius: var(--radius-xl);
            position: relative;
        }

        .inner-card {
            border: 2px solid rgba(216,180,254,.4);
            border-radius: var(--radius-lg);
            padding: clamp(1.25rem,4vw,2.5rem);
            background: rgba(255,255,255,.4);
        }

        /* --- Estilos Galer√≠a Polaroid --- */
        #galeria {
            padding: 4rem 1rem;
            text-align: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .gallery-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 3rem;
            margin-top: 3rem;
        }

        .polaroid {
            background: #fff;
            padding: 1rem 1rem 3.5rem 1rem;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease, z-index 0.3s;
            width: 280px;
            position: relative;
            cursor: pointer;
            border-radius: 2px;
        }

        .polaroid img {
            width: 100%;
            height: 280px;
            object-fit: cover;
            border: 1px solid #f0f0f0;
        }

        .polaroid:nth-child(odd) { transform: rotate(3deg); }
        .polaroid:nth-child(even) { transform: rotate(-3deg); }
        .polaroid:nth-child(3n) { transform: rotate(2deg); }
        .polaroid:nth-child(5n) { transform: rotate(-2deg); }

        .polaroid:hover {
            transform: scale(1.1) rotate(0deg) !important;
            z-index: 10;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .polaroid::after {
            content: '‚ù§Ô∏è';
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            font-size: 1.2rem;
            opacity: 0.6;
        }

        /* botones */
        button {
            border: none;
            cursor: pointer;
            font-size: clamp(.9rem,2.5vw,1rem);
        }

        .btn-primary {
            background: #111827;
            color: #fff;
            padding: .9rem 2rem;
            border-radius: 999px;
            display: inline-flex;
            gap: .5rem;
            align-items: center;
            transition: .25s;
            box-shadow: 0 10px 25px rgba(0,0,0,.15);
        }

        .btn-primary:hover { transform: scale(1.05); }

        .btn-gradient {
            background: linear-gradient(to right,#a855f7,#ec4899);
            color: #fff;
            padding: 1rem 2.5rem;
            border-radius: 999px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: .5rem;
            transition: .25s;
            box-shadow: 0 10px 25px rgba(168,85,247,.35);
        }

        .btn-gradient:hover {
            transform: translateY(-3px) scale(1.05);
        }

        /* corazones */
        .heart {
            position: fixed;
            bottom: -10vh;
            opacity: 0;
            animation: floatUp linear forwards;
            z-index: -1;
            font-size: 1.4rem;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(.6); opacity: 0; }
            10% { opacity: .8; }
            100% { transform: translateY(-110vh) scale(1.2); opacity: 0; }
        }

        footer {
            text-align: center;
            padding: clamp(3rem,10vw,6rem) 1.5rem;
        }

        @media(max-width:480px){
            #contenido-pdf { border-radius: var(--radius-md); }
            .glass-card { backdrop-filter: blur(16px); }
            .timer-box { gap: 1rem; padding: 1rem; }
            .timer-number { font-size: 1.5rem; }
            .timer-label { font-size: 0.7rem; }
            
            .polaroid { width: 100%; max-width: 300px; transform: rotate(0deg) !important; margin-bottom: 1rem; }
            .gallery-grid { gap: 1.5rem; }
        }
    </style>
</head>

<body>

<div class="animated-bg"></div>

<section class="hero">
    <div data-aos="fade-down" style="width: 100%; max-width: 800px; padding: 0 1rem;">
        
        <h1 class="font-romance" style="background:linear-gradient(to right,#9333ea,#ec4899);-webkit-background-clip:text;color:transparent; padding-right: 0.2em; padding-bottom: 0.1em;">
            Para mi amorcito David
        </h1>
        <p>Nuestro amor, nuestro presente, nuestro futuro.</p>

        <!-- CONTADOR -->
        <div id="contador-container">
            <p style="font-size: 0.9rem; margin-bottom: 0.5rem; opacity: 0.8;">Juntos desde el 22 de junio de 2025</p>
            <div class="timer-box">
                <div class="timer-item">
                    <span class="timer-number" id="dias">0</span>
                    <span class="timer-label">D√≠as</span>
                </div>
                <div class="timer-item">
                    <span class="timer-number" id="horas">0</span>
                    <span class="timer-label">Horas</span>
                </div>
                <div class="timer-item">
                    <span class="timer-number" id="minutos">0</span>
                    <span class="timer-label">Min</span>
                </div>
                <div class="timer-item">
                    <span class="timer-number" id="segundos">0</span>
                    <span class="timer-label">Seg</span>
                </div>
            </div>
        </div>

        <div style="margin-top: 1.5rem;">
            <button class="btn-primary"
                onclick="window.open('https://music.apple.com/es/song/ma%C3%B1ana-no-es-hoy-versi%C3%B3n-de-ximena/1797388606','_blank')">
                üéµ ‚ù§Ô∏è Antes de continuar... Hag√°moslo con m√∫sica ‚ù§Ô∏èüéµ
            </button>
        </div>
    </div>
</section>

<!-- IMPORTANTE: El ID aqu√≠ debe abarcar todo lo que quieres en el PDF -->
<!-- He movido el ID "contenido-pdf-wrapper" para envolver la carta y la galer√≠a si quisieras ambas, 
     pero por ahora mantendr√© la l√≥gica de descargar solo la carta como antes para asegurar que funcione,
     o podemos hacer un PDF de todo.
     
     Para este caso, voy a crear un contenedor espec√≠fico para la descarga que incluya la carta.
-->
<div id="area-impresion">
    <section id="carta">
        <div id="contenido-pdf" class="glass-card" data-aos="zoom-in-up">

            <span style="position:absolute;top:-1rem;left:-1rem;font-size:3rem;">üå∏</span>
            <span style="position:absolute;bottom:-1rem;right:-1rem;font-size:3rem;">‚ú®</span>

            <div class="inner-card">
                <h2 class="font-romance" style="text-align:center;color:#7e22ce;margin-bottom:2rem;">
                    Querido amorcito m√≠o:
                </h2>

                <div style="display:flex;flex-direction:column;gap:1.5rem;text-align:justify;">
                    <p>
                        Hoy quiero detener el tiempo un momento para decirte <strong style="color:#9333ea;">gracias</strong>.
                        Gracias por tu amor, por tu paciencia y por la forma tan bonita en la que eliges quedarte. ‚ù§Ô∏è
                    </p>

                    <p>
                        Te admiro profundamente: Por tu coraz√≥n noble, por tu entrega y por tu manera tan genuina
                        de transformar la vida de quienes te rodean. ‚ù§Ô∏è
                    </p>

                    <p>
                        Te regalo este LEGO porque representa lo que hemos estado haciendo: Construyendo el presente. 
                        Espero te guste este peque√±o detalle que te lo doy con todo mi coraz√≥n. ‚ù§Ô∏è
                    </p>

                    <p id="phrase-highlight">
                        Este mensaje es un recordatorio de algo muy simple pero poderoso:
                        <br>
                        <span style="background:#ede9fe;padding:.3rem .6rem;border-radius:.4rem; display:inline-block; margin-top:0.5rem;">
                            Te elijo hoy, ma√±ana y todos los d√≠as. ‚ù§Ô∏è
                        </span>
                    </p>

                    <div style="margin-top:3rem;border-top:1px solid #ddd;padding-top:1.5rem;">
                        <p class="font-romance" style="text-align:right;font-size:2rem;color:#9333ea;">
                            Te amo infinitamente, mi amorcito camell√≥n. ‚ù§Ô∏è
                        </p>
                        <p style="text-align:right;font-size:.8rem;letter-spacing:.15em;">
                            Con todo mi coraz√≥n<br>luis alberto
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="galeria" data-aos="fade-up">
        <h2 class="font-romance" style="color:#9333ea; font-size: 2.5rem; margin-bottom: 0.5rem;">
            Nuestros Momentos
        </h2>
        <p style="opacity: 0.7;">Coleccionando instantes contigo</p>

        <div class="gallery-grid">
            <div class="polaroid"> <img src="foto1.jpeg" alt="Foto 1" loading="lazy"> </div>
            <div class="polaroid"> <img src="foto2.jpeg" alt="Foto 2" loading="lazy"> </div>
            <div class="polaroid"> <img src="foto3.jpeg" alt="Foto 3" loading="lazy"> </div>
            <div class="polaroid"> <img src="foto4.jpeg" alt="Foto 4" loading="lazy"> </div>
            <div class="polaroid"> <img src="foto5.jpeg" alt="Foto 5" loading="lazy"> </div>
            <div class="polaroid"> <img src="foto6.jpeg" alt="Foto 6" loading="lazy"> </div>
        </div>
    </section>
</div>

<footer>
    <h4>Este mensaje es eterno üíå</h4>
    <p>Gu√°rdalo para leerlo cuando me extra√±es.</p>

    <div id="loading-msg" style="display:none; color:#9333ea; margin-bottom:1rem; font-weight:bold;">
        Generando tu carta... ‚ú®
    </div>

    <button id="btn-descarga" class="btn-gradient" onclick="descargarPDF()">‚¨á descargar carta en pdf</button>

    <div style="margin-top:3rem;opacity:.4;font-size:.7rem;letter-spacing:.2em;">
        Hecho con ‚ù§Ô∏è por luis alberto |
    </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<script>
    AOS.init({ duration: 1200, once: true });

    function createHeart() {
        const heart = document.createElement('div');
        heart.className = 'heart';
        heart.innerHTML = Math.random() > 0.5 ? '‚ù§Ô∏è' : 'üíú';
        heart.style.left = Math.random() * 100 + 'vw';
        heart.style.fontSize = (Math.random() * 1 + 1) + 'rem';
        heart.style.animationDuration = (Math.random() * 3 + 4) + 's';
        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 7000);
    }

    setInterval(createHeart, 400);

    const fechaInicio = new Date('2025-06-22T00:00:00');
    function actualizarContador() {
        const ahora = new Date();
        const diferencia = ahora - fechaInicio;
        const dias = Math.floor(diferencia / (1000 * 60 * 60 * 24));
        const horas = Math.floor((diferencia % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutos = Math.floor((diferencia % (1000 * 60 * 60)) / (1000 * 60));
        const segundos = Math.floor((diferencia % (1000 * 60)) / 1000);
        document.getElementById('dias').innerText = dias;
        document.getElementById('horas').innerText = horas;
        document.getElementById('minutos').innerText = minutos;
        document.getElementById('segundos').innerText = segundos;
    }
    setInterval(actualizarContador, 1000);
    actualizarContador();

    /* ===== PDF LOGIC OPTIMIZADA PARA M√ìVIL ===== */
    function descargarPDF() {
        const btn = document.getElementById('btn-descarga');
        const msg = document.getElementById('loading-msg');
        
        btn.disabled = true;
        btn.style.opacity = '0.5';
        btn.innerText = 'Procesando...';
        msg.style.display = 'block';

        // Usamos solo la carta para asegurar que funcione en m√≥vil, 
        // o si prefieres todo, cambia "contenido-pdf" por "area-impresion"
        // NOTA: Para m√≥vil es m√°s seguro imprimir solo la carta inicialmente para evitar crash por memoria
        const original = document.getElementById("contenido-pdf"); 
        
        const clone = original.cloneNode(true);

        // Limpieza de AOS
        clone.removeAttribute('data-aos');
        clone.classList.remove('aos-animate', 'aos-init');
        clone.querySelectorAll('[data-aos]').forEach(child => {
            child.removeAttribute('data-aos');
            child.classList.remove('aos-animate', 'aos-init');
        });

        // FIX M√ìVIL CR√çTICO: Quitar loading="lazy" de las im√°genes clonadas
        // Esto evita que el PDF salga en blanco esperando im√°genes que no cargan
        clone.querySelectorAll('img').forEach(img => {
            img.loading = "eager"; 
            img.removeAttribute('loading');
        });

        // Estilos planos para impresi√≥n
        clone.style.background = "#ffffff";
        clone.style.boxShadow = "none";
        clone.style.backdropFilter = "none";
        clone.style.webkitBackdropFilter = "none";
        clone.style.transform = "none";
        clone.style.margin = "0";
        clone.style.border = "none"; 
        clone.style.borderRadius = "0";
        clone.style.padding = "2rem"; 
        clone.style.width = "100%"; // Asegurar ancho completo

        // Ajuste de emojis
        const spans = clone.querySelectorAll('span[style*="position:absolute"]');
        spans.forEach(span => {
            if (span.innerHTML.includes('üå∏')) {
                 span.style.top = "1rem";
                 span.style.left = "1rem";
            }
            if (span.innerHTML.includes('‚ú®')) {
                 span.style.bottom = "1rem";
                 span.style.right = "1rem";
            }
        });

        const innerCard = clone.querySelector('.inner-card');
        if(innerCard) {
            innerCard.style.padding = "1.5rem"; 
            innerCard.style.border = "2px solid #d8b4fe";
            innerCard.style.borderRadius = "1rem";
            innerCard.style.backgroundColor = "#fff"; 
        }

        const h2 = clone.querySelector('h2');
        if(h2) {
            h2.style.fontSize = "2rem"; 
            h2.style.marginBottom = "1.5rem";
            h2.style.marginTop = "0";
        }

        const paragraphs = clone.querySelectorAll('p');
        paragraphs.forEach(p => {
            p.style.fontSize = "0.95rem"; 
            p.style.lineHeight = "1.4";
            p.style.marginBottom = "0.8rem";
            p.style.color = "#1f2937"; 
        });

        const highlightedSpan = clone.querySelector('span[style*="background"]');
        if (highlightedSpan) {
            const parentP = highlightedSpan.parentElement;
            if (parentP) {
                parentP.style.textAlign = "center"; 
                parentP.style.margin = "1.5rem 0"; 
            }
            highlightedSpan.style.display = "inline-block";
            highlightedSpan.style.padding = "0.4rem 1rem";
        }

        // Wrapper fuera de pantalla
        const wrapper = document.createElement("div");
        wrapper.style.position = "fixed";
        wrapper.style.top = "-9999px"; 
        wrapper.style.left = "0";
        // Ancho fijo adecuado para PDF A4/Letter
        wrapper.style.width = "750px"; 
        wrapper.style.zIndex = "-100";
        wrapper.appendChild(clone);
        document.body.appendChild(wrapper);

        // Detectar m√≥vil para reducir calidad si es necesario y evitar crash
        const isMobile = window.innerWidth < 768;
        const scaleFactor = isMobile ? 1.5 : 2; // Reducimos escala en m√≥vil

        setTimeout(() => {
            const opt = {
                margin:       [0.5, 0.5, 0.5, 0.5], 
                filename:     'Carta_para_David.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { 
                    scale: scaleFactor, // Escala adaptativa
                    useCORS: true, 
                    scrollY: 0,
                    backgroundColor: "#ffffff",
                    letterRendering: true,
                    allowTaint: true
                },
                jsPDF:        { unit: 'cm', format: 'letter', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(clone).save()
            .then(() => {
                document.body.removeChild(wrapper);
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.innerText = '‚¨á descargar carta en pdf';
                msg.style.display = 'none';
            })
            .catch(err => {
                console.error("Error:", err);
                alert("Error al generar PDF. Intenta de nuevo.");
                // Limpieza en caso de error
                if(document.body.contains(wrapper)) document.body.removeChild(wrapper);
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.innerText = '‚¨á descargar carta en pdf';
                msg.style.display = 'none';
            });
        }, 1000); // Aumentamos tiempo de espera para asegurar carga de recursos
    }
</script>

</body>
</html>
